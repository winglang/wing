{"version":3,"sources":["../src/internal.ts"],"sourcesContent":["import { join } from \"path\";\n\nexport interface CompileOptions {\n  workDir: string;\n  entrypoint: string;\n}\n\nexport async function compile(options: CompileOptions) {\n  const ts = (await import(\"typescript\")).default;\n  const outDir = join(options.workDir, \"ts\");\n\n  const program = ts.createProgram([options.entrypoint], {\n    target: ts.ScriptTarget.ES2022,\n    module: ts.ModuleKind.CommonJS,\n    moduleResolution: ts.ModuleResolutionKind.NodeJs,\n    alwaysStrict: true,\n    allowSyntheticDefaultImports: true,\n    esModuleInterop: true,\n    strict: true,\n    sourceMap: true,\n    outDir,\n    noEmitOnError: true,\n    listEmittedFiles: true,\n  })\n  const results = program.emit();\n\n  for (const diagnostic of results.diagnostics) {\n    console.error(diagnostic.messageText);\n  }\n  if (results.emitSkipped) {\n    throw new Error(\"TS compilation failed\");\n  }\n\n  // get the last .js file emitted, this should be the entrypoint\n  const emittedFiles = results.emittedFiles?.filter((f) => f.endsWith(\".js\"));\n  const emittedFile = emittedFiles?.[emittedFiles.length - 1];\n\n  if (!emittedFile) {\n    throw new Error(`TS compilation failed: Could not find emitted file in ${outDir}`);\n  }\n  \n  return emittedFile;\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAqB;AAOrB,eAAsB,QAAQ,SAAyB;AACrD,QAAM,MAAM,MAAM,OAAO,YAAY,GAAG;AACxC,QAAM,aAAS,kBAAK,QAAQ,SAAS,IAAI;AAEzC,QAAM,UAAU,GAAG,cAAc,CAAC,QAAQ,UAAU,GAAG;AAAA,IACrD,QAAQ,GAAG,aAAa;AAAA,IACxB,QAAQ,GAAG,WAAW;AAAA,IACtB,kBAAkB,GAAG,qBAAqB;AAAA,IAC1C,cAAc;AAAA,IACd,8BAA8B;AAAA,IAC9B,iBAAiB;AAAA,IACjB,QAAQ;AAAA,IACR,WAAW;AAAA,IACX;AAAA,IACA,eAAe;AAAA,IACf,kBAAkB;AAAA,EACpB,CAAC;AACD,QAAM,UAAU,QAAQ,KAAK;AAE7B,aAAW,cAAc,QAAQ,aAAa;AAC5C,YAAQ,MAAM,WAAW,WAAW;AAAA,EACtC;AACA,MAAI,QAAQ,aAAa;AACvB,UAAM,IAAI,MAAM,uBAAuB;AAAA,EACzC;AAGA,QAAM,eAAe,QAAQ,cAAc,OAAO,CAAC,MAAM,EAAE,SAAS,KAAK,CAAC;AAC1E,QAAM,cAAc,eAAe,aAAa,SAAS,CAAC;AAE1D,MAAI,CAAC,aAAa;AAChB,UAAM,IAAI,MAAM,yDAAyD,MAAM,EAAE;AAAA,EACnF;AAEA,SAAO;AACT;","names":[]}