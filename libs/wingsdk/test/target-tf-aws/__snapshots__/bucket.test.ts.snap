// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html

exports[`bucket is public 1`] = `
"{
  \\"output\\": {
    \\"WING_TEST_RUNNER_FUNCTION_ARNS\\": {
      \\"value\\": \\"[]\\"
    }
  },
  \\"resource\\": {
    \\"aws_s3_bucket\\": {
      \\"my_bucket\\": {
        \\"bucket_prefix\\": \\"my-bucket-c8045fcc-\\",
        \\"force_destroy\\": false
      }
    },
    \\"aws_s3_bucket_policy\\": {
      \\"my_bucket_PublicPolicy_AF351571\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"depends_on\\": [
          \\"aws_s3_bucket_public_access_block.my_bucket_PublicAccessBlock_538547C0\\"
        ],
        \\"policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Principal\\\\\\":\\\\\\"*\\\\\\",\\\\\\"Action\\\\\\":[\\\\\\"s3:GetObject\\\\\\"],\\\\\\"Resource\\\\\\":[\\\\\\"\${aws_s3_bucket.my_bucket.arn}/*\\\\\\"]}]}\\"
      }
    },
    \\"aws_s3_bucket_public_access_block\\": {
      \\"my_bucket_PublicAccessBlock_538547C0\\": {
        \\"block_public_acls\\": false,
        \\"block_public_policy\\": false,
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"ignore_public_acls\\": false,
        \\"restrict_public_buckets\\": false
      }
    },
    \\"aws_s3_bucket_server_side_encryption_configuration\\": {
      \\"my_bucket_Encryption_3B1569A4\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"rule\\": [
          {
            \\"apply_server_side_encryption_by_default\\": {
              \\"sse_algorithm\\": \\"AES256\\"
            }
          }
        ]
      }
    }
  }
}"
`;

exports[`bucket is public 2`] = `
{
  "tree": {
    "children": {
      "root": {
        "children": {
          "Default": {
            "children": {
              "aws": {
                "constructInfo": {
                  "fqn": "cdktf.TerraformProvider",
                  "version": "0.17.0",
                },
                "id": "aws",
                "path": "root/Default/aws",
              },
              "cloud.TestRunner": {
                "attributes": {
                  "wing:resource:connections": [],
                },
                "children": {
                  "TestFunctionArns": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformOutput",
                      "version": "0.17.0",
                    },
                    "id": "TestFunctionArns",
                    "path": "root/Default/cloud.TestRunner/TestFunctionArns",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A suite of APIs for running tests and collecting results.",
                  "hidden": true,
                  "title": "TestRunner",
                  "type": "user-named",
                },
                "id": "cloud.TestRunner",
                "path": "root/Default/cloud.TestRunner",
              },
              "my_bucket": {
                "attributes": {
                  "wing:resource:connections": [],
                },
                "children": {
                  "Default": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Default",
                    "path": "root/Default/my_bucket/Default",
                  },
                  "Encryption": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Encryption",
                    "path": "root/Default/my_bucket/Encryption",
                  },
                  "PublicAccessBlock": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "PublicAccessBlock",
                    "path": "root/Default/my_bucket/PublicAccessBlock",
                  },
                  "PublicPolicy": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "PublicPolicy",
                    "path": "root/Default/my_bucket/PublicPolicy",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A cloud object store",
                  "title": "Bucket",
                  "type": "user-named",
                },
                "id": "my_bucket",
                "path": "root/Default/my_bucket",
              },
            },
            "constructInfo": {
              "fqn": "constructs.Construct",
              "version": "10.1.314",
            },
            "id": "Default",
            "path": "root/Default",
          },
          "backend": {
            "constructInfo": {
              "fqn": "cdktf.LocalBackend",
              "version": "0.17.0",
            },
            "id": "backend",
            "path": "root/backend",
          },
        },
        "constructInfo": {
          "fqn": "cdktf.TerraformStack",
          "version": "0.17.0",
        },
        "id": "root",
        "path": "root",
      },
    },
    "constructInfo": {
      "fqn": "cdktf.App",
      "version": "0.17.0",
    },
    "id": "App",
    "path": "",
  },
  "version": "tree-0.1",
}
`;

exports[`bucket prefix must be lowercase 1`] = `
"{
  \\"output\\": {
    \\"WING_TEST_RUNNER_FUNCTION_ARNS\\": {
      \\"value\\": \\"[]\\"
    }
  },
  \\"resource\\": {
    \\"aws_s3_bucket\\": {
      \\"The-UncannyBucket\\": {
        \\"bucket_prefix\\": \\"the-uncanny-bucket-c88a0953-\\",
        \\"force_destroy\\": false
      }
    },
    \\"aws_s3_bucket_public_access_block\\": {
      \\"The-UncannyBucket_PublicAccessBlock_88AA9BF7\\": {
        \\"block_public_acls\\": true,
        \\"block_public_policy\\": true,
        \\"bucket\\": \\"\${aws_s3_bucket.The-UncannyBucket.bucket}\\",
        \\"ignore_public_acls\\": true,
        \\"restrict_public_buckets\\": true
      }
    },
    \\"aws_s3_bucket_server_side_encryption_configuration\\": {
      \\"The-UncannyBucket_Encryption_4CFC1E98\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.The-UncannyBucket.bucket}\\",
        \\"rule\\": [
          {
            \\"apply_server_side_encryption_by_default\\": {
              \\"sse_algorithm\\": \\"AES256\\"
            }
          }
        ]
      }
    }
  }
}"
`;

exports[`bucket prefix must be lowercase 2`] = `
{
  "tree": {
    "children": {
      "root": {
        "children": {
          "Default": {
            "children": {
              "The-Uncanny.Bucket": {
                "attributes": {
                  "wing:resource:connections": [],
                },
                "children": {
                  "Default": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Default",
                    "path": "root/Default/The-Uncanny.Bucket/Default",
                  },
                  "Encryption": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Encryption",
                    "path": "root/Default/The-Uncanny.Bucket/Encryption",
                  },
                  "PublicAccessBlock": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "PublicAccessBlock",
                    "path": "root/Default/The-Uncanny.Bucket/PublicAccessBlock",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A cloud object store",
                  "title": "Bucket",
                  "type": "user-named",
                },
                "id": "The-Uncanny.Bucket",
                "path": "root/Default/The-Uncanny.Bucket",
              },
              "aws": {
                "constructInfo": {
                  "fqn": "cdktf.TerraformProvider",
                  "version": "0.17.0",
                },
                "id": "aws",
                "path": "root/Default/aws",
              },
              "cloud.TestRunner": {
                "attributes": {
                  "wing:resource:connections": [],
                },
                "children": {
                  "TestFunctionArns": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformOutput",
                      "version": "0.17.0",
                    },
                    "id": "TestFunctionArns",
                    "path": "root/Default/cloud.TestRunner/TestFunctionArns",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A suite of APIs for running tests and collecting results.",
                  "hidden": true,
                  "title": "TestRunner",
                  "type": "user-named",
                },
                "id": "cloud.TestRunner",
                "path": "root/Default/cloud.TestRunner",
              },
            },
            "constructInfo": {
              "fqn": "constructs.Construct",
              "version": "10.1.314",
            },
            "id": "Default",
            "path": "root/Default",
          },
          "backend": {
            "constructInfo": {
              "fqn": "cdktf.LocalBackend",
              "version": "0.17.0",
            },
            "id": "backend",
            "path": "root/backend",
          },
        },
        "constructInfo": {
          "fqn": "cdktf.TerraformStack",
          "version": "0.17.0",
        },
        "id": "root",
        "path": "root",
      },
    },
    "constructInfo": {
      "fqn": "cdktf.App",
      "version": "0.17.0",
    },
    "id": "App",
    "path": "",
  },
  "version": "tree-0.1",
}
`;

exports[`bucket prefix valid 1`] = `
"{
  \\"output\\": {
    \\"WING_TEST_RUNNER_FUNCTION_ARNS\\": {
      \\"value\\": \\"[]\\"
    }
  },
  \\"resource\\": {
    \\"aws_s3_bucket\\": {
      \\"the-uncannybucket\\": {
        \\"bucket_prefix\\": \\"the-uncanny-bucket-c8e2755c-\\",
        \\"force_destroy\\": false
      }
    },
    \\"aws_s3_bucket_public_access_block\\": {
      \\"the-uncannybucket_PublicAccessBlock_AC5BC68C\\": {
        \\"block_public_acls\\": true,
        \\"block_public_policy\\": true,
        \\"bucket\\": \\"\${aws_s3_bucket.the-uncannybucket.bucket}\\",
        \\"ignore_public_acls\\": true,
        \\"restrict_public_buckets\\": true
      }
    },
    \\"aws_s3_bucket_server_side_encryption_configuration\\": {
      \\"the-uncannybucket_Encryption_78D02B71\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.the-uncannybucket.bucket}\\",
        \\"rule\\": [
          {
            \\"apply_server_side_encryption_by_default\\": {
              \\"sse_algorithm\\": \\"AES256\\"
            }
          }
        ]
      }
    }
  }
}"
`;

exports[`bucket prefix valid 2`] = `
{
  "tree": {
    "children": {
      "root": {
        "children": {
          "Default": {
            "children": {
              "aws": {
                "constructInfo": {
                  "fqn": "cdktf.TerraformProvider",
                  "version": "0.17.0",
                },
                "id": "aws",
                "path": "root/Default/aws",
              },
              "cloud.TestRunner": {
                "attributes": {
                  "wing:resource:connections": [],
                },
                "children": {
                  "TestFunctionArns": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformOutput",
                      "version": "0.17.0",
                    },
                    "id": "TestFunctionArns",
                    "path": "root/Default/cloud.TestRunner/TestFunctionArns",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A suite of APIs for running tests and collecting results.",
                  "hidden": true,
                  "title": "TestRunner",
                  "type": "user-named",
                },
                "id": "cloud.TestRunner",
                "path": "root/Default/cloud.TestRunner",
              },
              "the-uncanny.bucket": {
                "attributes": {
                  "wing:resource:connections": [],
                },
                "children": {
                  "Default": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Default",
                    "path": "root/Default/the-uncanny.bucket/Default",
                  },
                  "Encryption": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Encryption",
                    "path": "root/Default/the-uncanny.bucket/Encryption",
                  },
                  "PublicAccessBlock": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "PublicAccessBlock",
                    "path": "root/Default/the-uncanny.bucket/PublicAccessBlock",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A cloud object store",
                  "title": "Bucket",
                  "type": "user-named",
                },
                "id": "the-uncanny.bucket",
                "path": "root/Default/the-uncanny.bucket",
              },
            },
            "constructInfo": {
              "fqn": "constructs.Construct",
              "version": "10.1.314",
            },
            "id": "Default",
            "path": "root/Default",
          },
          "backend": {
            "constructInfo": {
              "fqn": "cdktf.LocalBackend",
              "version": "0.17.0",
            },
            "id": "backend",
            "path": "root/backend",
          },
        },
        "constructInfo": {
          "fqn": "cdktf.TerraformStack",
          "version": "0.17.0",
        },
        "id": "root",
        "path": "root",
      },
    },
    "constructInfo": {
      "fqn": "cdktf.App",
      "version": "0.17.0",
    },
    "id": "App",
    "path": "",
  },
  "version": "tree-0.1",
}
`;

exports[`bucket with onCreate method 1`] = `
"{
  \\"output\\": {
    \\"WING_TEST_RUNNER_FUNCTION_ARNS\\": {
      \\"value\\": \\"[]\\"
    }
  },
  \\"resource\\": {
    \\"aws_iam_role\\": {
      \\"my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_IamRole_35A9A03F\\": {
        \\"assume_role_policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Action\\\\\\":\\\\\\"sts:AssumeRole\\\\\\",\\\\\\"Principal\\\\\\":{\\\\\\"Service\\\\\\":\\\\\\"lambda.amazonaws.com\\\\\\"},\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\"}]}\\"
      }
    },
    \\"aws_iam_role_policy\\": {
      \\"my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_IamRolePolicy_97F83F8D\\": {
        \\"policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Action\\\\\\":\\\\\\"none:null\\\\\\",\\\\\\"Resource\\\\\\":\\\\\\"*\\\\\\"}]}\\",
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_IamRole_35A9A03F.name}\\"
      }
    },
    \\"aws_iam_role_policy_attachment\\": {
      \\"my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_IamRolePolicyAttachment_66038538\\": {
        \\"policy_arn\\": \\"arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\\",
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_IamRole_35A9A03F.name}\\"
      }
    },
    \\"aws_lambda_function\\": {
      \\"my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_21FC0692\\": {
        \\"environment\\": {
          \\"variables\\": {
            \\"WING_FUNCTION_NAME\\": \\"my_bucket-oncreate-OnMessage-1000fbe7-c8902807\\"
          }
        },
        \\"function_name\\": \\"my_bucket-oncreate-OnMessage-1000fbe7-c8902807\\",
        \\"handler\\": \\"index.handler\\",
        \\"publish\\": true,
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_IamRole_35A9A03F.arn}\\",
        \\"runtime\\": \\"nodejs18.x\\",
        \\"s3_bucket\\": \\"\${aws_s3_bucket.Code.bucket}\\",
        \\"s3_key\\": \\"\${aws_s3_object.my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_S3Object_0EFF5E1C.key}\\",
        \\"timeout\\": 30,
        \\"vpc_config\\": {
          \\"security_group_ids\\": [],
          \\"subnet_ids\\": []
        }
      }
    },
    \\"aws_lambda_permission\\": {
      \\"my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_InvokePermission-c81e8728eb64a11308ced47594c2396d2467e4d9d3_9B4C34C5\\": {
        \\"action\\": \\"lambda:InvokeFunction\\",
        \\"function_name\\": \\"\${aws_lambda_function.my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_21FC0692.function_name}\\",
        \\"principal\\": \\"sns.amazonaws.com\\",
        \\"source_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-oncreate_820372FA.arn}\\"
      }
    },
    \\"aws_s3_bucket\\": {
      \\"Code\\": {
        \\"bucket_prefix\\": \\"code-c84a50b1-\\"
      },
      \\"my_bucket\\": {
        \\"bucket_prefix\\": \\"my-bucket-c8045fcc-\\",
        \\"force_destroy\\": false
      }
    },
    \\"aws_s3_bucket_notification\\": {
      \\"my_bucket_S3BucketNotification_DDA29E8F\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.id}\\",
        \\"depends_on\\": [
          \\"aws_sns_topic_policy.my_bucket_my_bucket-oncreate_PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a_DC469583\\"
        ],
        \\"topic\\": [
          {
            \\"events\\": [
              \\"s3:ObjectCreated:Put\\"
            ],
            \\"id\\": \\"on-oncreate-notification\\",
            \\"topic_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-oncreate_820372FA.arn}\\"
          }
        ]
      }
    },
    \\"aws_s3_bucket_policy\\": {
      \\"my_bucket_PublicPolicy_AF351571\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"depends_on\\": [
          \\"aws_s3_bucket_public_access_block.my_bucket_PublicAccessBlock_538547C0\\"
        ],
        \\"policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Principal\\\\\\":\\\\\\"*\\\\\\",\\\\\\"Action\\\\\\":[\\\\\\"s3:GetObject\\\\\\"],\\\\\\"Resource\\\\\\":[\\\\\\"\${aws_s3_bucket.my_bucket.arn}/*\\\\\\"]}]}\\"
      }
    },
    \\"aws_s3_bucket_public_access_block\\": {
      \\"my_bucket_PublicAccessBlock_538547C0\\": {
        \\"block_public_acls\\": false,
        \\"block_public_policy\\": false,
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"ignore_public_acls\\": false,
        \\"restrict_public_buckets\\": false
      }
    },
    \\"aws_s3_bucket_server_side_encryption_configuration\\": {
      \\"my_bucket_Encryption_3B1569A4\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"rule\\": [
          {
            \\"apply_server_side_encryption_by_default\\": {
              \\"sse_algorithm\\": \\"AES256\\"
            }
          }
        ]
      }
    },
    \\"aws_s3_object\\": {
      \\"my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_S3Object_0EFF5E1C\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.Code.bucket}\\",
        \\"key\\": \\"<key>\\",
        \\"source\\": \\"<source>\\"
      }
    },
    \\"aws_sns_topic\\": {
      \\"my_bucket_my_bucket-oncreate_820372FA\\": {
        \\"name\\": \\"my_bucket-oncreate-c81e8728\\"
      }
    },
    \\"aws_sns_topic_policy\\": {
      \\"my_bucket_my_bucket-oncreate_PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a_DC469583\\": {
        \\"arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-oncreate_820372FA.arn}\\",
        \\"policy\\": \\"{\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Principal\\\\\\":{\\\\\\"Service\\\\\\":\\\\\\"s3.amazonaws.com\\\\\\"},\\\\\\"Action\\\\\\":\\\\\\"sns:Publish\\\\\\",\\\\\\"Resource\\\\\\":\\\\\\"\${aws_sns_topic.my_bucket_my_bucket-oncreate_820372FA.arn}\\\\\\",\\\\\\"Condition\\\\\\":{\\\\\\"ArnEquals\\\\\\":{\\\\\\"aws:SourceArn\\\\\\":\\\\\\"\${aws_s3_bucket.my_bucket.arn}\\\\\\"}}}]}\\"
      }
    },
    \\"aws_sns_topic_subscription\\": {
      \\"my_bucket_my_bucket-oncreate_my_bucket-oncreate-TopicSubscription-1000fbe7_9F6DDCDF\\": {
        \\"endpoint\\": \\"\${aws_lambda_function.my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_21FC0692.arn}\\",
        \\"protocol\\": \\"lambda\\",
        \\"topic_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-oncreate_820372FA.arn}\\"
      }
    }
  }
}"
`;

exports[`bucket with onCreate method 2`] = `
{
  "tree": {
    "children": {
      "root": {
        "children": {
          "Default": {
            "children": {
              "Code": {
                "constructInfo": {
                  "fqn": "cdktf.TerraformResource",
                  "version": "0.17.0",
                },
                "id": "Code",
                "path": "root/Default/Code",
              },
              "aws": {
                "constructInfo": {
                  "fqn": "cdktf.TerraformProvider",
                  "version": "0.17.0",
                },
                "id": "aws",
                "path": "root/Default/aws",
              },
              "cloud.TestRunner": {
                "attributes": {
                  "wing:resource:connections": [],
                },
                "children": {
                  "TestFunctionArns": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformOutput",
                      "version": "0.17.0",
                    },
                    "id": "TestFunctionArns",
                    "path": "root/Default/cloud.TestRunner/TestFunctionArns",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A suite of APIs for running tests and collecting results.",
                  "hidden": true,
                  "title": "TestRunner",
                  "type": "user-named",
                },
                "id": "cloud.TestRunner",
                "path": "root/Default/cloud.TestRunner",
              },
              "inflight": {
                "attributes": {
                  "wing:resource:connections": [
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "handle()",
                      "resource": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7",
                    },
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "$inflight_init()",
                      "resource": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7",
                    },
                  ],
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "An inflight resource",
                  "hidden": true,
                  "title": "Inflight",
                  "type": "user-named",
                },
                "id": "inflight",
                "path": "root/Default/inflight",
              },
              "my_bucket": {
                "attributes": {
                  "wing:resource:connections": [
                    {
                      "direction": "outbound",
                      "implicit": false,
                      "relationship": "onCreate()",
                      "resource": "root/Default/my_bucket/my_bucket-oncreate",
                    },
                  ],
                },
                "children": {
                  "Default": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Default",
                    "path": "root/Default/my_bucket/Default",
                  },
                  "Encryption": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Encryption",
                    "path": "root/Default/my_bucket/Encryption",
                  },
                  "PublicAccessBlock": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "PublicAccessBlock",
                    "path": "root/Default/my_bucket/PublicAccessBlock",
                  },
                  "PublicPolicy": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "PublicPolicy",
                    "path": "root/Default/my_bucket/PublicPolicy",
                  },
                  "S3BucketNotification": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "S3BucketNotification",
                    "path": "root/Default/my_bucket/S3BucketNotification",
                  },
                  "my_bucket-oncreate": {
                    "attributes": {
                      "wing:resource:connections": [
                        {
                          "direction": "inbound",
                          "implicit": false,
                          "relationship": "onCreate()",
                          "resource": "root/Default/my_bucket",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "onMessage()",
                          "resource": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7",
                        },
                      ],
                    },
                    "children": {
                      "Default": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "Default",
                        "path": "root/Default/my_bucket/my_bucket-oncreate/Default",
                      },
                      "PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a",
                        "path": "root/Default/my_bucket/my_bucket-oncreate/PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a",
                      },
                      "my_bucket-oncreate-TopicSubscription-1000fbe7": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "my_bucket-oncreate-TopicSubscription-1000fbe7",
                        "path": "root/Default/my_bucket/my_bucket-oncreate/my_bucket-oncreate-TopicSubscription-1000fbe7",
                      },
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "description": "A pub/sub notification topic",
                      "title": "Topic",
                      "type": "user-named",
                    },
                    "id": "my_bucket-oncreate",
                    "path": "root/Default/my_bucket/my_bucket-oncreate",
                  },
                  "my_bucket-oncreate-OnMessage-1000fbe7": {
                    "attributes": {
                      "wing:resource:connections": [
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "handle()",
                          "resource": "root/Default/inflight",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "$inflight_init()",
                          "resource": "root/Default/inflight",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "handle()",
                          "resource": "root/Default/my_bucket-oncreate-eventHandler-9eade8f6",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "$inflight_init()",
                          "resource": "root/Default/my_bucket-oncreate-eventHandler-9eade8f6",
                        },
                        {
                          "direction": "inbound",
                          "implicit": false,
                          "relationship": "onMessage()",
                          "resource": "root/Default/my_bucket/my_bucket-oncreate",
                        },
                      ],
                    },
                    "children": {
                      "Asset": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformAsset",
                          "version": "0.17.0",
                        },
                        "id": "Asset",
                        "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7/Asset",
                      },
                      "Default": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "Default",
                        "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7/Default",
                      },
                      "IamRole": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRole",
                        "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7/IamRole",
                      },
                      "IamRolePolicy": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRolePolicy",
                        "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7/IamRolePolicy",
                      },
                      "IamRolePolicyAttachment": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRolePolicyAttachment",
                        "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7/IamRolePolicyAttachment",
                      },
                      "InvokePermission-c81e8728eb64a11308ced47594c2396d2467e4d9d3": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "InvokePermission-c81e8728eb64a11308ced47594c2396d2467e4d9d3",
                        "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7/InvokePermission-c81e8728eb64a11308ced47594c2396d2467e4d9d3",
                      },
                      "S3Object": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "S3Object",
                        "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7/S3Object",
                      },
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "description": "A cloud function (FaaS)",
                      "title": "Function",
                      "type": "compiler-named",
                    },
                    "id": "my_bucket-oncreate-OnMessage-1000fbe7",
                    "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7",
                  },
                  "my_bucket-oncreate-OnMessageHandler-1000fbe7": {
                    "attributes": {
                      "wing:resource:connections": [],
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "hidden": true,
                      "type": "user-named",
                    },
                    "id": "my_bucket-oncreate-OnMessageHandler-1000fbe7",
                    "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessageHandler-1000fbe7",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A cloud object store",
                  "title": "Bucket",
                  "type": "user-named",
                },
                "id": "my_bucket",
                "path": "root/Default/my_bucket",
              },
              "my_bucket-oncreate-eventHandler-9eade8f6": {
                "attributes": {
                  "wing:resource:connections": [
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "handle()",
                      "resource": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7",
                    },
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "$inflight_init()",
                      "resource": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7",
                    },
                  ],
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "hidden": true,
                  "type": "user-named",
                },
                "id": "my_bucket-oncreate-eventHandler-9eade8f6",
                "path": "root/Default/my_bucket-oncreate-eventHandler-9eade8f6",
              },
            },
            "constructInfo": {
              "fqn": "constructs.Construct",
              "version": "10.1.314",
            },
            "id": "Default",
            "path": "root/Default",
          },
          "backend": {
            "constructInfo": {
              "fqn": "cdktf.LocalBackend",
              "version": "0.17.0",
            },
            "id": "backend",
            "path": "root/backend",
          },
        },
        "constructInfo": {
          "fqn": "cdktf.TerraformStack",
          "version": "0.17.0",
        },
        "id": "root",
        "path": "root",
      },
    },
    "constructInfo": {
      "fqn": "cdktf.App",
      "version": "0.17.0",
    },
    "id": "App",
    "path": "",
  },
  "version": "tree-0.1",
}
`;

exports[`bucket with onDelete method 1`] = `
"{
  \\"output\\": {
    \\"WING_TEST_RUNNER_FUNCTION_ARNS\\": {
      \\"value\\": \\"[]\\"
    }
  },
  \\"resource\\": {
    \\"aws_iam_role\\": {
      \\"my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_IamRole_07615065\\": {
        \\"assume_role_policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Action\\\\\\":\\\\\\"sts:AssumeRole\\\\\\",\\\\\\"Principal\\\\\\":{\\\\\\"Service\\\\\\":\\\\\\"lambda.amazonaws.com\\\\\\"},\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\"}]}\\"
      }
    },
    \\"aws_iam_role_policy\\": {
      \\"my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_IamRolePolicy_9B9E2210\\": {
        \\"policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Action\\\\\\":\\\\\\"none:null\\\\\\",\\\\\\"Resource\\\\\\":\\\\\\"*\\\\\\"}]}\\",
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_IamRole_07615065.name}\\"
      }
    },
    \\"aws_iam_role_policy_attachment\\": {
      \\"my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_IamRolePolicyAttachment_DF48669C\\": {
        \\"policy_arn\\": \\"arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\\",
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_IamRole_07615065.name}\\"
      }
    },
    \\"aws_lambda_function\\": {
      \\"my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_F0204E1B\\": {
        \\"environment\\": {
          \\"variables\\": {
            \\"WING_FUNCTION_NAME\\": \\"my_bucket-ondelete-OnMessage-107fa7e8-c8a44ddc\\"
          }
        },
        \\"function_name\\": \\"my_bucket-ondelete-OnMessage-107fa7e8-c8a44ddc\\",
        \\"handler\\": \\"index.handler\\",
        \\"publish\\": true,
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_IamRole_07615065.arn}\\",
        \\"runtime\\": \\"nodejs18.x\\",
        \\"s3_bucket\\": \\"\${aws_s3_bucket.Code.bucket}\\",
        \\"s3_key\\": \\"\${aws_s3_object.my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_S3Object_E3EEAE82.key}\\",
        \\"timeout\\": 30,
        \\"vpc_config\\": {
          \\"security_group_ids\\": [],
          \\"subnet_ids\\": []
        }
      }
    },
    \\"aws_lambda_permission\\": {
      \\"my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_InvokePermission-c804d947f12e6d883f018387429c0ba10b852c46ba_ACC48827\\": {
        \\"action\\": \\"lambda:InvokeFunction\\",
        \\"function_name\\": \\"\${aws_lambda_function.my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_F0204E1B.function_name}\\",
        \\"principal\\": \\"sns.amazonaws.com\\",
        \\"source_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-ondelete_D8AB43D6.arn}\\"
      }
    },
    \\"aws_s3_bucket\\": {
      \\"Code\\": {
        \\"bucket_prefix\\": \\"code-c84a50b1-\\"
      },
      \\"my_bucket\\": {
        \\"bucket_prefix\\": \\"my-bucket-c8045fcc-\\",
        \\"force_destroy\\": false
      }
    },
    \\"aws_s3_bucket_notification\\": {
      \\"my_bucket_S3BucketNotification_DDA29E8F\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.id}\\",
        \\"depends_on\\": [
          \\"aws_sns_topic_policy.my_bucket_my_bucket-ondelete_PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a_87361222\\"
        ],
        \\"topic\\": [
          {
            \\"events\\": [
              \\"s3:ObjectRemoved:*\\"
            ],
            \\"id\\": \\"on-ondelete-notification\\",
            \\"topic_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-ondelete_D8AB43D6.arn}\\"
          }
        ]
      }
    },
    \\"aws_s3_bucket_policy\\": {
      \\"my_bucket_PublicPolicy_AF351571\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"depends_on\\": [
          \\"aws_s3_bucket_public_access_block.my_bucket_PublicAccessBlock_538547C0\\"
        ],
        \\"policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Principal\\\\\\":\\\\\\"*\\\\\\",\\\\\\"Action\\\\\\":[\\\\\\"s3:GetObject\\\\\\"],\\\\\\"Resource\\\\\\":[\\\\\\"\${aws_s3_bucket.my_bucket.arn}/*\\\\\\"]}]}\\"
      }
    },
    \\"aws_s3_bucket_public_access_block\\": {
      \\"my_bucket_PublicAccessBlock_538547C0\\": {
        \\"block_public_acls\\": false,
        \\"block_public_policy\\": false,
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"ignore_public_acls\\": false,
        \\"restrict_public_buckets\\": false
      }
    },
    \\"aws_s3_bucket_server_side_encryption_configuration\\": {
      \\"my_bucket_Encryption_3B1569A4\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"rule\\": [
          {
            \\"apply_server_side_encryption_by_default\\": {
              \\"sse_algorithm\\": \\"AES256\\"
            }
          }
        ]
      }
    },
    \\"aws_s3_object\\": {
      \\"my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_S3Object_E3EEAE82\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.Code.bucket}\\",
        \\"key\\": \\"<key>\\",
        \\"source\\": \\"<source>\\"
      }
    },
    \\"aws_sns_topic\\": {
      \\"my_bucket_my_bucket-ondelete_D8AB43D6\\": {
        \\"name\\": \\"my_bucket-ondelete-c804d947\\"
      }
    },
    \\"aws_sns_topic_policy\\": {
      \\"my_bucket_my_bucket-ondelete_PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a_87361222\\": {
        \\"arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-ondelete_D8AB43D6.arn}\\",
        \\"policy\\": \\"{\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Principal\\\\\\":{\\\\\\"Service\\\\\\":\\\\\\"s3.amazonaws.com\\\\\\"},\\\\\\"Action\\\\\\":\\\\\\"sns:Publish\\\\\\",\\\\\\"Resource\\\\\\":\\\\\\"\${aws_sns_topic.my_bucket_my_bucket-ondelete_D8AB43D6.arn}\\\\\\",\\\\\\"Condition\\\\\\":{\\\\\\"ArnEquals\\\\\\":{\\\\\\"aws:SourceArn\\\\\\":\\\\\\"\${aws_s3_bucket.my_bucket.arn}\\\\\\"}}}]}\\"
      }
    },
    \\"aws_sns_topic_subscription\\": {
      \\"my_bucket_my_bucket-ondelete_my_bucket-ondelete-TopicSubscription-107fa7e8_AC27B137\\": {
        \\"endpoint\\": \\"\${aws_lambda_function.my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_F0204E1B.arn}\\",
        \\"protocol\\": \\"lambda\\",
        \\"topic_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-ondelete_D8AB43D6.arn}\\"
      }
    }
  }
}"
`;

exports[`bucket with onDelete method 2`] = `
{
  "tree": {
    "children": {
      "root": {
        "children": {
          "Default": {
            "children": {
              "Code": {
                "constructInfo": {
                  "fqn": "cdktf.TerraformResource",
                  "version": "0.17.0",
                },
                "id": "Code",
                "path": "root/Default/Code",
              },
              "aws": {
                "constructInfo": {
                  "fqn": "cdktf.TerraformProvider",
                  "version": "0.17.0",
                },
                "id": "aws",
                "path": "root/Default/aws",
              },
              "cloud.TestRunner": {
                "attributes": {
                  "wing:resource:connections": [],
                },
                "children": {
                  "TestFunctionArns": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformOutput",
                      "version": "0.17.0",
                    },
                    "id": "TestFunctionArns",
                    "path": "root/Default/cloud.TestRunner/TestFunctionArns",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A suite of APIs for running tests and collecting results.",
                  "hidden": true,
                  "title": "TestRunner",
                  "type": "user-named",
                },
                "id": "cloud.TestRunner",
                "path": "root/Default/cloud.TestRunner",
              },
              "inflight": {
                "attributes": {
                  "wing:resource:connections": [
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "handle()",
                      "resource": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8",
                    },
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "$inflight_init()",
                      "resource": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8",
                    },
                  ],
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "An inflight resource",
                  "hidden": true,
                  "title": "Inflight",
                  "type": "user-named",
                },
                "id": "inflight",
                "path": "root/Default/inflight",
              },
              "my_bucket": {
                "attributes": {
                  "wing:resource:connections": [
                    {
                      "direction": "outbound",
                      "implicit": false,
                      "relationship": "onDelete()",
                      "resource": "root/Default/my_bucket/my_bucket-ondelete",
                    },
                  ],
                },
                "children": {
                  "Default": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Default",
                    "path": "root/Default/my_bucket/Default",
                  },
                  "Encryption": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Encryption",
                    "path": "root/Default/my_bucket/Encryption",
                  },
                  "PublicAccessBlock": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "PublicAccessBlock",
                    "path": "root/Default/my_bucket/PublicAccessBlock",
                  },
                  "PublicPolicy": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "PublicPolicy",
                    "path": "root/Default/my_bucket/PublicPolicy",
                  },
                  "S3BucketNotification": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "S3BucketNotification",
                    "path": "root/Default/my_bucket/S3BucketNotification",
                  },
                  "my_bucket-ondelete": {
                    "attributes": {
                      "wing:resource:connections": [
                        {
                          "direction": "inbound",
                          "implicit": false,
                          "relationship": "onDelete()",
                          "resource": "root/Default/my_bucket",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "onMessage()",
                          "resource": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8",
                        },
                      ],
                    },
                    "children": {
                      "Default": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "Default",
                        "path": "root/Default/my_bucket/my_bucket-ondelete/Default",
                      },
                      "PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a",
                        "path": "root/Default/my_bucket/my_bucket-ondelete/PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a",
                      },
                      "my_bucket-ondelete-TopicSubscription-107fa7e8": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "my_bucket-ondelete-TopicSubscription-107fa7e8",
                        "path": "root/Default/my_bucket/my_bucket-ondelete/my_bucket-ondelete-TopicSubscription-107fa7e8",
                      },
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "description": "A pub/sub notification topic",
                      "title": "Topic",
                      "type": "user-named",
                    },
                    "id": "my_bucket-ondelete",
                    "path": "root/Default/my_bucket/my_bucket-ondelete",
                  },
                  "my_bucket-ondelete-OnMessage-107fa7e8": {
                    "attributes": {
                      "wing:resource:connections": [
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "handle()",
                          "resource": "root/Default/inflight",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "$inflight_init()",
                          "resource": "root/Default/inflight",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "handle()",
                          "resource": "root/Default/my_bucket-ondelete-eventHandler-9eade8f6",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "$inflight_init()",
                          "resource": "root/Default/my_bucket-ondelete-eventHandler-9eade8f6",
                        },
                        {
                          "direction": "inbound",
                          "implicit": false,
                          "relationship": "onMessage()",
                          "resource": "root/Default/my_bucket/my_bucket-ondelete",
                        },
                      ],
                    },
                    "children": {
                      "Asset": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformAsset",
                          "version": "0.17.0",
                        },
                        "id": "Asset",
                        "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8/Asset",
                      },
                      "Default": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "Default",
                        "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8/Default",
                      },
                      "IamRole": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRole",
                        "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8/IamRole",
                      },
                      "IamRolePolicy": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRolePolicy",
                        "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8/IamRolePolicy",
                      },
                      "IamRolePolicyAttachment": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRolePolicyAttachment",
                        "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8/IamRolePolicyAttachment",
                      },
                      "InvokePermission-c804d947f12e6d883f018387429c0ba10b852c46ba": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "InvokePermission-c804d947f12e6d883f018387429c0ba10b852c46ba",
                        "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8/InvokePermission-c804d947f12e6d883f018387429c0ba10b852c46ba",
                      },
                      "S3Object": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "S3Object",
                        "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8/S3Object",
                      },
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "description": "A cloud function (FaaS)",
                      "title": "Function",
                      "type": "compiler-named",
                    },
                    "id": "my_bucket-ondelete-OnMessage-107fa7e8",
                    "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8",
                  },
                  "my_bucket-ondelete-OnMessageHandler-107fa7e8": {
                    "attributes": {
                      "wing:resource:connections": [],
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "hidden": true,
                      "type": "user-named",
                    },
                    "id": "my_bucket-ondelete-OnMessageHandler-107fa7e8",
                    "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessageHandler-107fa7e8",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A cloud object store",
                  "title": "Bucket",
                  "type": "user-named",
                },
                "id": "my_bucket",
                "path": "root/Default/my_bucket",
              },
              "my_bucket-ondelete-eventHandler-9eade8f6": {
                "attributes": {
                  "wing:resource:connections": [
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "handle()",
                      "resource": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8",
                    },
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "$inflight_init()",
                      "resource": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8",
                    },
                  ],
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "hidden": true,
                  "type": "user-named",
                },
                "id": "my_bucket-ondelete-eventHandler-9eade8f6",
                "path": "root/Default/my_bucket-ondelete-eventHandler-9eade8f6",
              },
            },
            "constructInfo": {
              "fqn": "constructs.Construct",
              "version": "10.1.314",
            },
            "id": "Default",
            "path": "root/Default",
          },
          "backend": {
            "constructInfo": {
              "fqn": "cdktf.LocalBackend",
              "version": "0.17.0",
            },
            "id": "backend",
            "path": "root/backend",
          },
        },
        "constructInfo": {
          "fqn": "cdktf.TerraformStack",
          "version": "0.17.0",
        },
        "id": "root",
        "path": "root",
      },
    },
    "constructInfo": {
      "fqn": "cdktf.App",
      "version": "0.17.0",
    },
    "id": "App",
    "path": "",
  },
  "version": "tree-0.1",
}
`;

exports[`bucket with onEvent method 1`] = `
"{
  \\"output\\": {
    \\"WING_TEST_RUNNER_FUNCTION_ARNS\\": {
      \\"value\\": \\"[]\\"
    }
  },
  \\"resource\\": {
    \\"aws_iam_role\\": {
      \\"my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_IamRole_35A9A03F\\": {
        \\"assume_role_policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Action\\\\\\":\\\\\\"sts:AssumeRole\\\\\\",\\\\\\"Principal\\\\\\":{\\\\\\"Service\\\\\\":\\\\\\"lambda.amazonaws.com\\\\\\"},\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\"}]}\\"
      },
      \\"my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_IamRole_07615065\\": {
        \\"assume_role_policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Action\\\\\\":\\\\\\"sts:AssumeRole\\\\\\",\\\\\\"Principal\\\\\\":{\\\\\\"Service\\\\\\":\\\\\\"lambda.amazonaws.com\\\\\\"},\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\"}]}\\"
      },
      \\"my_bucket_my_bucket-onupdate-OnMessage-02f87005_IamRole_33D65E9E\\": {
        \\"assume_role_policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Action\\\\\\":\\\\\\"sts:AssumeRole\\\\\\",\\\\\\"Principal\\\\\\":{\\\\\\"Service\\\\\\":\\\\\\"lambda.amazonaws.com\\\\\\"},\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\"}]}\\"
      }
    },
    \\"aws_iam_role_policy\\": {
      \\"my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_IamRolePolicy_97F83F8D\\": {
        \\"policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Action\\\\\\":\\\\\\"none:null\\\\\\",\\\\\\"Resource\\\\\\":\\\\\\"*\\\\\\"}]}\\",
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_IamRole_35A9A03F.name}\\"
      },
      \\"my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_IamRolePolicy_9B9E2210\\": {
        \\"policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Action\\\\\\":\\\\\\"none:null\\\\\\",\\\\\\"Resource\\\\\\":\\\\\\"*\\\\\\"}]}\\",
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_IamRole_07615065.name}\\"
      },
      \\"my_bucket_my_bucket-onupdate-OnMessage-02f87005_IamRolePolicy_26721ED9\\": {
        \\"policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Action\\\\\\":\\\\\\"none:null\\\\\\",\\\\\\"Resource\\\\\\":\\\\\\"*\\\\\\"}]}\\",
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-onupdate-OnMessage-02f87005_IamRole_33D65E9E.name}\\"
      }
    },
    \\"aws_iam_role_policy_attachment\\": {
      \\"my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_IamRolePolicyAttachment_66038538\\": {
        \\"policy_arn\\": \\"arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\\",
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_IamRole_35A9A03F.name}\\"
      },
      \\"my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_IamRolePolicyAttachment_DF48669C\\": {
        \\"policy_arn\\": \\"arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\\",
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_IamRole_07615065.name}\\"
      },
      \\"my_bucket_my_bucket-onupdate-OnMessage-02f87005_IamRolePolicyAttachment_2E33E422\\": {
        \\"policy_arn\\": \\"arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\\",
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-onupdate-OnMessage-02f87005_IamRole_33D65E9E.name}\\"
      }
    },
    \\"aws_lambda_function\\": {
      \\"my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_21FC0692\\": {
        \\"environment\\": {
          \\"variables\\": {
            \\"WING_FUNCTION_NAME\\": \\"my_bucket-oncreate-OnMessage-1000fbe7-c8902807\\"
          }
        },
        \\"function_name\\": \\"my_bucket-oncreate-OnMessage-1000fbe7-c8902807\\",
        \\"handler\\": \\"index.handler\\",
        \\"publish\\": true,
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_IamRole_35A9A03F.arn}\\",
        \\"runtime\\": \\"nodejs18.x\\",
        \\"s3_bucket\\": \\"\${aws_s3_bucket.Code.bucket}\\",
        \\"s3_key\\": \\"\${aws_s3_object.my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_S3Object_0EFF5E1C.key}\\",
        \\"timeout\\": 30,
        \\"vpc_config\\": {
          \\"security_group_ids\\": [],
          \\"subnet_ids\\": []
        }
      },
      \\"my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_F0204E1B\\": {
        \\"environment\\": {
          \\"variables\\": {
            \\"WING_FUNCTION_NAME\\": \\"my_bucket-ondelete-OnMessage-107fa7e8-c8a44ddc\\"
          }
        },
        \\"function_name\\": \\"my_bucket-ondelete-OnMessage-107fa7e8-c8a44ddc\\",
        \\"handler\\": \\"index.handler\\",
        \\"publish\\": true,
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_IamRole_07615065.arn}\\",
        \\"runtime\\": \\"nodejs18.x\\",
        \\"s3_bucket\\": \\"\${aws_s3_bucket.Code.bucket}\\",
        \\"s3_key\\": \\"\${aws_s3_object.my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_S3Object_E3EEAE82.key}\\",
        \\"timeout\\": 30,
        \\"vpc_config\\": {
          \\"security_group_ids\\": [],
          \\"subnet_ids\\": []
        }
      },
      \\"my_bucket_my_bucket-onupdate-OnMessage-02f87005_5A1876F6\\": {
        \\"environment\\": {
          \\"variables\\": {
            \\"WING_FUNCTION_NAME\\": \\"my_bucket-onupdate-OnMessage-02f87005-c8addd34\\"
          }
        },
        \\"function_name\\": \\"my_bucket-onupdate-OnMessage-02f87005-c8addd34\\",
        \\"handler\\": \\"index.handler\\",
        \\"publish\\": true,
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-onupdate-OnMessage-02f87005_IamRole_33D65E9E.arn}\\",
        \\"runtime\\": \\"nodejs18.x\\",
        \\"s3_bucket\\": \\"\${aws_s3_bucket.Code.bucket}\\",
        \\"s3_key\\": \\"\${aws_s3_object.my_bucket_my_bucket-onupdate-OnMessage-02f87005_S3Object_22E0515D.key}\\",
        \\"timeout\\": 30,
        \\"vpc_config\\": {
          \\"security_group_ids\\": [],
          \\"subnet_ids\\": []
        }
      }
    },
    \\"aws_lambda_permission\\": {
      \\"my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_InvokePermission-c81e8728eb64a11308ced47594c2396d2467e4d9d3_9B4C34C5\\": {
        \\"action\\": \\"lambda:InvokeFunction\\",
        \\"function_name\\": \\"\${aws_lambda_function.my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_21FC0692.function_name}\\",
        \\"principal\\": \\"sns.amazonaws.com\\",
        \\"source_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-oncreate_820372FA.arn}\\"
      },
      \\"my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_InvokePermission-c804d947f12e6d883f018387429c0ba10b852c46ba_ACC48827\\": {
        \\"action\\": \\"lambda:InvokeFunction\\",
        \\"function_name\\": \\"\${aws_lambda_function.my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_F0204E1B.function_name}\\",
        \\"principal\\": \\"sns.amazonaws.com\\",
        \\"source_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-ondelete_D8AB43D6.arn}\\"
      },
      \\"my_bucket_my_bucket-onupdate-OnMessage-02f87005_InvokePermission-c85a09033744f6af2426f88e40823fbfd778fbdc16_79677ADE\\": {
        \\"action\\": \\"lambda:InvokeFunction\\",
        \\"function_name\\": \\"\${aws_lambda_function.my_bucket_my_bucket-onupdate-OnMessage-02f87005_5A1876F6.function_name}\\",
        \\"principal\\": \\"sns.amazonaws.com\\",
        \\"source_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-onupdate_ADC4AA5B.arn}\\"
      }
    },
    \\"aws_s3_bucket\\": {
      \\"Code\\": {
        \\"bucket_prefix\\": \\"code-c84a50b1-\\"
      },
      \\"my_bucket\\": {
        \\"bucket_prefix\\": \\"my-bucket-c8045fcc-\\",
        \\"force_destroy\\": false
      }
    },
    \\"aws_s3_bucket_notification\\": {
      \\"my_bucket_S3BucketNotification_DDA29E8F\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.id}\\",
        \\"depends_on\\": [
          \\"aws_sns_topic_policy.my_bucket_my_bucket-oncreate_PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a_DC469583\\",
          \\"aws_sns_topic_policy.my_bucket_my_bucket-onupdate_PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a_CDA9888A\\",
          \\"aws_sns_topic_policy.my_bucket_my_bucket-ondelete_PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a_87361222\\"
        ],
        \\"topic\\": [
          {
            \\"events\\": [
              \\"s3:ObjectCreated:Put\\"
            ],
            \\"id\\": \\"on-oncreate-notification\\",
            \\"topic_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-oncreate_820372FA.arn}\\"
          },
          {
            \\"events\\": [
              \\"s3:ObjectCreated:Post\\"
            ],
            \\"id\\": \\"on-onupdate-notification\\",
            \\"topic_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-onupdate_ADC4AA5B.arn}\\"
          },
          {
            \\"events\\": [
              \\"s3:ObjectRemoved:*\\"
            ],
            \\"id\\": \\"on-ondelete-notification\\",
            \\"topic_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-ondelete_D8AB43D6.arn}\\"
          }
        ]
      }
    },
    \\"aws_s3_bucket_policy\\": {
      \\"my_bucket_PublicPolicy_AF351571\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"depends_on\\": [
          \\"aws_s3_bucket_public_access_block.my_bucket_PublicAccessBlock_538547C0\\"
        ],
        \\"policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Principal\\\\\\":\\\\\\"*\\\\\\",\\\\\\"Action\\\\\\":[\\\\\\"s3:GetObject\\\\\\"],\\\\\\"Resource\\\\\\":[\\\\\\"\${aws_s3_bucket.my_bucket.arn}/*\\\\\\"]}]}\\"
      }
    },
    \\"aws_s3_bucket_public_access_block\\": {
      \\"my_bucket_PublicAccessBlock_538547C0\\": {
        \\"block_public_acls\\": false,
        \\"block_public_policy\\": false,
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"ignore_public_acls\\": false,
        \\"restrict_public_buckets\\": false
      }
    },
    \\"aws_s3_bucket_server_side_encryption_configuration\\": {
      \\"my_bucket_Encryption_3B1569A4\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"rule\\": [
          {
            \\"apply_server_side_encryption_by_default\\": {
              \\"sse_algorithm\\": \\"AES256\\"
            }
          }
        ]
      }
    },
    \\"aws_s3_object\\": {
      \\"my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_S3Object_0EFF5E1C\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.Code.bucket}\\",
        \\"key\\": \\"<key>\\",
        \\"source\\": \\"<source>\\"
      },
      \\"my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_S3Object_E3EEAE82\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.Code.bucket}\\",
        \\"key\\": \\"<key>\\",
        \\"source\\": \\"<source>\\"
      },
      \\"my_bucket_my_bucket-onupdate-OnMessage-02f87005_S3Object_22E0515D\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.Code.bucket}\\",
        \\"key\\": \\"<key>\\",
        \\"source\\": \\"<source>\\"
      }
    },
    \\"aws_sns_topic\\": {
      \\"my_bucket_my_bucket-oncreate_820372FA\\": {
        \\"name\\": \\"my_bucket-oncreate-c81e8728\\"
      },
      \\"my_bucket_my_bucket-ondelete_D8AB43D6\\": {
        \\"name\\": \\"my_bucket-ondelete-c804d947\\"
      },
      \\"my_bucket_my_bucket-onupdate_ADC4AA5B\\": {
        \\"name\\": \\"my_bucket-onupdate-c85a0903\\"
      }
    },
    \\"aws_sns_topic_policy\\": {
      \\"my_bucket_my_bucket-oncreate_PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a_DC469583\\": {
        \\"arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-oncreate_820372FA.arn}\\",
        \\"policy\\": \\"{\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Principal\\\\\\":{\\\\\\"Service\\\\\\":\\\\\\"s3.amazonaws.com\\\\\\"},\\\\\\"Action\\\\\\":\\\\\\"sns:Publish\\\\\\",\\\\\\"Resource\\\\\\":\\\\\\"\${aws_sns_topic.my_bucket_my_bucket-oncreate_820372FA.arn}\\\\\\",\\\\\\"Condition\\\\\\":{\\\\\\"ArnEquals\\\\\\":{\\\\\\"aws:SourceArn\\\\\\":\\\\\\"\${aws_s3_bucket.my_bucket.arn}\\\\\\"}}}]}\\"
      },
      \\"my_bucket_my_bucket-ondelete_PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a_87361222\\": {
        \\"arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-ondelete_D8AB43D6.arn}\\",
        \\"policy\\": \\"{\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Principal\\\\\\":{\\\\\\"Service\\\\\\":\\\\\\"s3.amazonaws.com\\\\\\"},\\\\\\"Action\\\\\\":\\\\\\"sns:Publish\\\\\\",\\\\\\"Resource\\\\\\":\\\\\\"\${aws_sns_topic.my_bucket_my_bucket-ondelete_D8AB43D6.arn}\\\\\\",\\\\\\"Condition\\\\\\":{\\\\\\"ArnEquals\\\\\\":{\\\\\\"aws:SourceArn\\\\\\":\\\\\\"\${aws_s3_bucket.my_bucket.arn}\\\\\\"}}}]}\\"
      },
      \\"my_bucket_my_bucket-onupdate_PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a_CDA9888A\\": {
        \\"arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-onupdate_ADC4AA5B.arn}\\",
        \\"policy\\": \\"{\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Principal\\\\\\":{\\\\\\"Service\\\\\\":\\\\\\"s3.amazonaws.com\\\\\\"},\\\\\\"Action\\\\\\":\\\\\\"sns:Publish\\\\\\",\\\\\\"Resource\\\\\\":\\\\\\"\${aws_sns_topic.my_bucket_my_bucket-onupdate_ADC4AA5B.arn}\\\\\\",\\\\\\"Condition\\\\\\":{\\\\\\"ArnEquals\\\\\\":{\\\\\\"aws:SourceArn\\\\\\":\\\\\\"\${aws_s3_bucket.my_bucket.arn}\\\\\\"}}}]}\\"
      }
    },
    \\"aws_sns_topic_subscription\\": {
      \\"my_bucket_my_bucket-oncreate_my_bucket-oncreate-TopicSubscription-1000fbe7_9F6DDCDF\\": {
        \\"endpoint\\": \\"\${aws_lambda_function.my_bucket_my_bucket-oncreate-OnMessage-1000fbe7_21FC0692.arn}\\",
        \\"protocol\\": \\"lambda\\",
        \\"topic_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-oncreate_820372FA.arn}\\"
      },
      \\"my_bucket_my_bucket-ondelete_my_bucket-ondelete-TopicSubscription-107fa7e8_AC27B137\\": {
        \\"endpoint\\": \\"\${aws_lambda_function.my_bucket_my_bucket-ondelete-OnMessage-107fa7e8_F0204E1B.arn}\\",
        \\"protocol\\": \\"lambda\\",
        \\"topic_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-ondelete_D8AB43D6.arn}\\"
      },
      \\"my_bucket_my_bucket-onupdate_my_bucket-onupdate-TopicSubscription-02f87005_6CFFDD03\\": {
        \\"endpoint\\": \\"\${aws_lambda_function.my_bucket_my_bucket-onupdate-OnMessage-02f87005_5A1876F6.arn}\\",
        \\"protocol\\": \\"lambda\\",
        \\"topic_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-onupdate_ADC4AA5B.arn}\\"
      }
    }
  }
}"
`;

exports[`bucket with onEvent method 2`] = `
{
  "tree": {
    "children": {
      "root": {
        "children": {
          "Default": {
            "children": {
              "Code": {
                "constructInfo": {
                  "fqn": "cdktf.TerraformResource",
                  "version": "0.17.0",
                },
                "id": "Code",
                "path": "root/Default/Code",
              },
              "aws": {
                "constructInfo": {
                  "fqn": "cdktf.TerraformProvider",
                  "version": "0.17.0",
                },
                "id": "aws",
                "path": "root/Default/aws",
              },
              "cloud.TestRunner": {
                "attributes": {
                  "wing:resource:connections": [],
                },
                "children": {
                  "TestFunctionArns": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformOutput",
                      "version": "0.17.0",
                    },
                    "id": "TestFunctionArns",
                    "path": "root/Default/cloud.TestRunner/TestFunctionArns",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A suite of APIs for running tests and collecting results.",
                  "hidden": true,
                  "title": "TestRunner",
                  "type": "user-named",
                },
                "id": "cloud.TestRunner",
                "path": "root/Default/cloud.TestRunner",
              },
              "inflight": {
                "attributes": {
                  "wing:resource:connections": [
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "handle()",
                      "resource": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7",
                    },
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "$inflight_init()",
                      "resource": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7",
                    },
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "handle()",
                      "resource": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005",
                    },
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "$inflight_init()",
                      "resource": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005",
                    },
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "handle()",
                      "resource": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8",
                    },
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "$inflight_init()",
                      "resource": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8",
                    },
                  ],
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "An inflight resource",
                  "hidden": true,
                  "title": "Inflight",
                  "type": "user-named",
                },
                "id": "inflight",
                "path": "root/Default/inflight",
              },
              "my_bucket": {
                "attributes": {
                  "wing:resource:connections": [
                    {
                      "direction": "outbound",
                      "implicit": false,
                      "relationship": "onCreate()",
                      "resource": "root/Default/my_bucket/my_bucket-oncreate",
                    },
                    {
                      "direction": "outbound",
                      "implicit": false,
                      "relationship": "onUpdate()",
                      "resource": "root/Default/my_bucket/my_bucket-onupdate",
                    },
                    {
                      "direction": "outbound",
                      "implicit": false,
                      "relationship": "onDelete()",
                      "resource": "root/Default/my_bucket/my_bucket-ondelete",
                    },
                  ],
                },
                "children": {
                  "Default": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Default",
                    "path": "root/Default/my_bucket/Default",
                  },
                  "Encryption": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Encryption",
                    "path": "root/Default/my_bucket/Encryption",
                  },
                  "PublicAccessBlock": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "PublicAccessBlock",
                    "path": "root/Default/my_bucket/PublicAccessBlock",
                  },
                  "PublicPolicy": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "PublicPolicy",
                    "path": "root/Default/my_bucket/PublicPolicy",
                  },
                  "S3BucketNotification": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "S3BucketNotification",
                    "path": "root/Default/my_bucket/S3BucketNotification",
                  },
                  "my_bucket-oncreate": {
                    "attributes": {
                      "wing:resource:connections": [
                        {
                          "direction": "inbound",
                          "implicit": false,
                          "relationship": "onCreate()",
                          "resource": "root/Default/my_bucket",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "onMessage()",
                          "resource": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7",
                        },
                      ],
                    },
                    "children": {
                      "Default": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "Default",
                        "path": "root/Default/my_bucket/my_bucket-oncreate/Default",
                      },
                      "PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a",
                        "path": "root/Default/my_bucket/my_bucket-oncreate/PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a",
                      },
                      "my_bucket-oncreate-TopicSubscription-1000fbe7": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "my_bucket-oncreate-TopicSubscription-1000fbe7",
                        "path": "root/Default/my_bucket/my_bucket-oncreate/my_bucket-oncreate-TopicSubscription-1000fbe7",
                      },
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "description": "A pub/sub notification topic",
                      "title": "Topic",
                      "type": "user-named",
                    },
                    "id": "my_bucket-oncreate",
                    "path": "root/Default/my_bucket/my_bucket-oncreate",
                  },
                  "my_bucket-oncreate-OnMessage-1000fbe7": {
                    "attributes": {
                      "wing:resource:connections": [
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "handle()",
                          "resource": "root/Default/inflight",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "$inflight_init()",
                          "resource": "root/Default/inflight",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "handle()",
                          "resource": "root/Default/my_bucket-oncreate-eventHandler-9eade8f6",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "$inflight_init()",
                          "resource": "root/Default/my_bucket-oncreate-eventHandler-9eade8f6",
                        },
                        {
                          "direction": "inbound",
                          "implicit": false,
                          "relationship": "onMessage()",
                          "resource": "root/Default/my_bucket/my_bucket-oncreate",
                        },
                      ],
                    },
                    "children": {
                      "Asset": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformAsset",
                          "version": "0.17.0",
                        },
                        "id": "Asset",
                        "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7/Asset",
                      },
                      "Default": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "Default",
                        "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7/Default",
                      },
                      "IamRole": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRole",
                        "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7/IamRole",
                      },
                      "IamRolePolicy": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRolePolicy",
                        "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7/IamRolePolicy",
                      },
                      "IamRolePolicyAttachment": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRolePolicyAttachment",
                        "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7/IamRolePolicyAttachment",
                      },
                      "InvokePermission-c81e8728eb64a11308ced47594c2396d2467e4d9d3": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "InvokePermission-c81e8728eb64a11308ced47594c2396d2467e4d9d3",
                        "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7/InvokePermission-c81e8728eb64a11308ced47594c2396d2467e4d9d3",
                      },
                      "S3Object": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "S3Object",
                        "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7/S3Object",
                      },
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "description": "A cloud function (FaaS)",
                      "title": "Function",
                      "type": "compiler-named",
                    },
                    "id": "my_bucket-oncreate-OnMessage-1000fbe7",
                    "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7",
                  },
                  "my_bucket-oncreate-OnMessageHandler-1000fbe7": {
                    "attributes": {
                      "wing:resource:connections": [],
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "hidden": true,
                      "type": "user-named",
                    },
                    "id": "my_bucket-oncreate-OnMessageHandler-1000fbe7",
                    "path": "root/Default/my_bucket/my_bucket-oncreate-OnMessageHandler-1000fbe7",
                  },
                  "my_bucket-ondelete": {
                    "attributes": {
                      "wing:resource:connections": [
                        {
                          "direction": "inbound",
                          "implicit": false,
                          "relationship": "onDelete()",
                          "resource": "root/Default/my_bucket",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "onMessage()",
                          "resource": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8",
                        },
                      ],
                    },
                    "children": {
                      "Default": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "Default",
                        "path": "root/Default/my_bucket/my_bucket-ondelete/Default",
                      },
                      "PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a",
                        "path": "root/Default/my_bucket/my_bucket-ondelete/PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a",
                      },
                      "my_bucket-ondelete-TopicSubscription-107fa7e8": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "my_bucket-ondelete-TopicSubscription-107fa7e8",
                        "path": "root/Default/my_bucket/my_bucket-ondelete/my_bucket-ondelete-TopicSubscription-107fa7e8",
                      },
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "description": "A pub/sub notification topic",
                      "title": "Topic",
                      "type": "user-named",
                    },
                    "id": "my_bucket-ondelete",
                    "path": "root/Default/my_bucket/my_bucket-ondelete",
                  },
                  "my_bucket-ondelete-OnMessage-107fa7e8": {
                    "attributes": {
                      "wing:resource:connections": [
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "handle()",
                          "resource": "root/Default/inflight",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "$inflight_init()",
                          "resource": "root/Default/inflight",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "handle()",
                          "resource": "root/Default/my_bucket-ondelete-eventHandler-9eade8f6",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "$inflight_init()",
                          "resource": "root/Default/my_bucket-ondelete-eventHandler-9eade8f6",
                        },
                        {
                          "direction": "inbound",
                          "implicit": false,
                          "relationship": "onMessage()",
                          "resource": "root/Default/my_bucket/my_bucket-ondelete",
                        },
                      ],
                    },
                    "children": {
                      "Asset": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformAsset",
                          "version": "0.17.0",
                        },
                        "id": "Asset",
                        "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8/Asset",
                      },
                      "Default": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "Default",
                        "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8/Default",
                      },
                      "IamRole": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRole",
                        "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8/IamRole",
                      },
                      "IamRolePolicy": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRolePolicy",
                        "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8/IamRolePolicy",
                      },
                      "IamRolePolicyAttachment": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRolePolicyAttachment",
                        "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8/IamRolePolicyAttachment",
                      },
                      "InvokePermission-c804d947f12e6d883f018387429c0ba10b852c46ba": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "InvokePermission-c804d947f12e6d883f018387429c0ba10b852c46ba",
                        "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8/InvokePermission-c804d947f12e6d883f018387429c0ba10b852c46ba",
                      },
                      "S3Object": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "S3Object",
                        "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8/S3Object",
                      },
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "description": "A cloud function (FaaS)",
                      "title": "Function",
                      "type": "compiler-named",
                    },
                    "id": "my_bucket-ondelete-OnMessage-107fa7e8",
                    "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8",
                  },
                  "my_bucket-ondelete-OnMessageHandler-107fa7e8": {
                    "attributes": {
                      "wing:resource:connections": [],
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "hidden": true,
                      "type": "user-named",
                    },
                    "id": "my_bucket-ondelete-OnMessageHandler-107fa7e8",
                    "path": "root/Default/my_bucket/my_bucket-ondelete-OnMessageHandler-107fa7e8",
                  },
                  "my_bucket-onupdate": {
                    "attributes": {
                      "wing:resource:connections": [
                        {
                          "direction": "inbound",
                          "implicit": false,
                          "relationship": "onUpdate()",
                          "resource": "root/Default/my_bucket",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "onMessage()",
                          "resource": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005",
                        },
                      ],
                    },
                    "children": {
                      "Default": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "Default",
                        "path": "root/Default/my_bucket/my_bucket-onupdate/Default",
                      },
                      "PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a",
                        "path": "root/Default/my_bucket/my_bucket-onupdate/PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a",
                      },
                      "my_bucket-onupdate-TopicSubscription-02f87005": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "my_bucket-onupdate-TopicSubscription-02f87005",
                        "path": "root/Default/my_bucket/my_bucket-onupdate/my_bucket-onupdate-TopicSubscription-02f87005",
                      },
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "description": "A pub/sub notification topic",
                      "title": "Topic",
                      "type": "user-named",
                    },
                    "id": "my_bucket-onupdate",
                    "path": "root/Default/my_bucket/my_bucket-onupdate",
                  },
                  "my_bucket-onupdate-OnMessage-02f87005": {
                    "attributes": {
                      "wing:resource:connections": [
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "handle()",
                          "resource": "root/Default/inflight",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "$inflight_init()",
                          "resource": "root/Default/inflight",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "handle()",
                          "resource": "root/Default/my_bucket-onupdate-eventHandler-9eade8f6",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "$inflight_init()",
                          "resource": "root/Default/my_bucket-onupdate-eventHandler-9eade8f6",
                        },
                        {
                          "direction": "inbound",
                          "implicit": false,
                          "relationship": "onMessage()",
                          "resource": "root/Default/my_bucket/my_bucket-onupdate",
                        },
                      ],
                    },
                    "children": {
                      "Asset": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformAsset",
                          "version": "0.17.0",
                        },
                        "id": "Asset",
                        "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005/Asset",
                      },
                      "Default": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "Default",
                        "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005/Default",
                      },
                      "IamRole": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRole",
                        "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005/IamRole",
                      },
                      "IamRolePolicy": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRolePolicy",
                        "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005/IamRolePolicy",
                      },
                      "IamRolePolicyAttachment": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRolePolicyAttachment",
                        "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005/IamRolePolicyAttachment",
                      },
                      "InvokePermission-c85a09033744f6af2426f88e40823fbfd778fbdc16": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "InvokePermission-c85a09033744f6af2426f88e40823fbfd778fbdc16",
                        "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005/InvokePermission-c85a09033744f6af2426f88e40823fbfd778fbdc16",
                      },
                      "S3Object": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "S3Object",
                        "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005/S3Object",
                      },
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "description": "A cloud function (FaaS)",
                      "title": "Function",
                      "type": "compiler-named",
                    },
                    "id": "my_bucket-onupdate-OnMessage-02f87005",
                    "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005",
                  },
                  "my_bucket-onupdate-OnMessageHandler-02f87005": {
                    "attributes": {
                      "wing:resource:connections": [],
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "hidden": true,
                      "type": "user-named",
                    },
                    "id": "my_bucket-onupdate-OnMessageHandler-02f87005",
                    "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessageHandler-02f87005",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A cloud object store",
                  "title": "Bucket",
                  "type": "user-named",
                },
                "id": "my_bucket",
                "path": "root/Default/my_bucket",
              },
              "my_bucket-oncreate-eventHandler-9eade8f6": {
                "attributes": {
                  "wing:resource:connections": [
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "handle()",
                      "resource": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7",
                    },
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "$inflight_init()",
                      "resource": "root/Default/my_bucket/my_bucket-oncreate-OnMessage-1000fbe7",
                    },
                  ],
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "hidden": true,
                  "type": "user-named",
                },
                "id": "my_bucket-oncreate-eventHandler-9eade8f6",
                "path": "root/Default/my_bucket-oncreate-eventHandler-9eade8f6",
              },
              "my_bucket-ondelete-eventHandler-9eade8f6": {
                "attributes": {
                  "wing:resource:connections": [
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "handle()",
                      "resource": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8",
                    },
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "$inflight_init()",
                      "resource": "root/Default/my_bucket/my_bucket-ondelete-OnMessage-107fa7e8",
                    },
                  ],
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "hidden": true,
                  "type": "user-named",
                },
                "id": "my_bucket-ondelete-eventHandler-9eade8f6",
                "path": "root/Default/my_bucket-ondelete-eventHandler-9eade8f6",
              },
              "my_bucket-onupdate-eventHandler-9eade8f6": {
                "attributes": {
                  "wing:resource:connections": [
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "handle()",
                      "resource": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005",
                    },
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "$inflight_init()",
                      "resource": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005",
                    },
                  ],
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "hidden": true,
                  "type": "user-named",
                },
                "id": "my_bucket-onupdate-eventHandler-9eade8f6",
                "path": "root/Default/my_bucket-onupdate-eventHandler-9eade8f6",
              },
            },
            "constructInfo": {
              "fqn": "constructs.Construct",
              "version": "10.1.314",
            },
            "id": "Default",
            "path": "root/Default",
          },
          "backend": {
            "constructInfo": {
              "fqn": "cdktf.LocalBackend",
              "version": "0.17.0",
            },
            "id": "backend",
            "path": "root/backend",
          },
        },
        "constructInfo": {
          "fqn": "cdktf.TerraformStack",
          "version": "0.17.0",
        },
        "id": "root",
        "path": "root",
      },
    },
    "constructInfo": {
      "fqn": "cdktf.App",
      "version": "0.17.0",
    },
    "id": "App",
    "path": "",
  },
  "version": "tree-0.1",
}
`;

exports[`bucket with onUpdate method 1`] = `
"{
  \\"output\\": {
    \\"WING_TEST_RUNNER_FUNCTION_ARNS\\": {
      \\"value\\": \\"[]\\"
    }
  },
  \\"resource\\": {
    \\"aws_iam_role\\": {
      \\"my_bucket_my_bucket-onupdate-OnMessage-02f87005_IamRole_33D65E9E\\": {
        \\"assume_role_policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Action\\\\\\":\\\\\\"sts:AssumeRole\\\\\\",\\\\\\"Principal\\\\\\":{\\\\\\"Service\\\\\\":\\\\\\"lambda.amazonaws.com\\\\\\"},\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\"}]}\\"
      }
    },
    \\"aws_iam_role_policy\\": {
      \\"my_bucket_my_bucket-onupdate-OnMessage-02f87005_IamRolePolicy_26721ED9\\": {
        \\"policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Action\\\\\\":\\\\\\"none:null\\\\\\",\\\\\\"Resource\\\\\\":\\\\\\"*\\\\\\"}]}\\",
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-onupdate-OnMessage-02f87005_IamRole_33D65E9E.name}\\"
      }
    },
    \\"aws_iam_role_policy_attachment\\": {
      \\"my_bucket_my_bucket-onupdate-OnMessage-02f87005_IamRolePolicyAttachment_2E33E422\\": {
        \\"policy_arn\\": \\"arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\\",
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-onupdate-OnMessage-02f87005_IamRole_33D65E9E.name}\\"
      }
    },
    \\"aws_lambda_function\\": {
      \\"my_bucket_my_bucket-onupdate-OnMessage-02f87005_5A1876F6\\": {
        \\"environment\\": {
          \\"variables\\": {
            \\"WING_FUNCTION_NAME\\": \\"my_bucket-onupdate-OnMessage-02f87005-c8addd34\\"
          }
        },
        \\"function_name\\": \\"my_bucket-onupdate-OnMessage-02f87005-c8addd34\\",
        \\"handler\\": \\"index.handler\\",
        \\"publish\\": true,
        \\"role\\": \\"\${aws_iam_role.my_bucket_my_bucket-onupdate-OnMessage-02f87005_IamRole_33D65E9E.arn}\\",
        \\"runtime\\": \\"nodejs18.x\\",
        \\"s3_bucket\\": \\"\${aws_s3_bucket.Code.bucket}\\",
        \\"s3_key\\": \\"\${aws_s3_object.my_bucket_my_bucket-onupdate-OnMessage-02f87005_S3Object_22E0515D.key}\\",
        \\"timeout\\": 30,
        \\"vpc_config\\": {
          \\"security_group_ids\\": [],
          \\"subnet_ids\\": []
        }
      }
    },
    \\"aws_lambda_permission\\": {
      \\"my_bucket_my_bucket-onupdate-OnMessage-02f87005_InvokePermission-c85a09033744f6af2426f88e40823fbfd778fbdc16_79677ADE\\": {
        \\"action\\": \\"lambda:InvokeFunction\\",
        \\"function_name\\": \\"\${aws_lambda_function.my_bucket_my_bucket-onupdate-OnMessage-02f87005_5A1876F6.function_name}\\",
        \\"principal\\": \\"sns.amazonaws.com\\",
        \\"source_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-onupdate_ADC4AA5B.arn}\\"
      }
    },
    \\"aws_s3_bucket\\": {
      \\"Code\\": {
        \\"bucket_prefix\\": \\"code-c84a50b1-\\"
      },
      \\"my_bucket\\": {
        \\"bucket_prefix\\": \\"my-bucket-c8045fcc-\\",
        \\"force_destroy\\": false
      }
    },
    \\"aws_s3_bucket_notification\\": {
      \\"my_bucket_S3BucketNotification_DDA29E8F\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.id}\\",
        \\"depends_on\\": [
          \\"aws_sns_topic_policy.my_bucket_my_bucket-onupdate_PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a_CDA9888A\\"
        ],
        \\"topic\\": [
          {
            \\"events\\": [
              \\"s3:ObjectCreated:Post\\"
            ],
            \\"id\\": \\"on-onupdate-notification\\",
            \\"topic_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-onupdate_ADC4AA5B.arn}\\"
          }
        ]
      }
    },
    \\"aws_s3_bucket_policy\\": {
      \\"my_bucket_PublicPolicy_AF351571\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"depends_on\\": [
          \\"aws_s3_bucket_public_access_block.my_bucket_PublicAccessBlock_538547C0\\"
        ],
        \\"policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Principal\\\\\\":\\\\\\"*\\\\\\",\\\\\\"Action\\\\\\":[\\\\\\"s3:GetObject\\\\\\"],\\\\\\"Resource\\\\\\":[\\\\\\"\${aws_s3_bucket.my_bucket.arn}/*\\\\\\"]}]}\\"
      }
    },
    \\"aws_s3_bucket_public_access_block\\": {
      \\"my_bucket_PublicAccessBlock_538547C0\\": {
        \\"block_public_acls\\": false,
        \\"block_public_policy\\": false,
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"ignore_public_acls\\": false,
        \\"restrict_public_buckets\\": false
      }
    },
    \\"aws_s3_bucket_server_side_encryption_configuration\\": {
      \\"my_bucket_Encryption_3B1569A4\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"rule\\": [
          {
            \\"apply_server_side_encryption_by_default\\": {
              \\"sse_algorithm\\": \\"AES256\\"
            }
          }
        ]
      }
    },
    \\"aws_s3_object\\": {
      \\"my_bucket_my_bucket-onupdate-OnMessage-02f87005_S3Object_22E0515D\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.Code.bucket}\\",
        \\"key\\": \\"<key>\\",
        \\"source\\": \\"<source>\\"
      }
    },
    \\"aws_sns_topic\\": {
      \\"my_bucket_my_bucket-onupdate_ADC4AA5B\\": {
        \\"name\\": \\"my_bucket-onupdate-c85a0903\\"
      }
    },
    \\"aws_sns_topic_policy\\": {
      \\"my_bucket_my_bucket-onupdate_PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a_CDA9888A\\": {
        \\"arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-onupdate_ADC4AA5B.arn}\\",
        \\"policy\\": \\"{\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Principal\\\\\\":{\\\\\\"Service\\\\\\":\\\\\\"s3.amazonaws.com\\\\\\"},\\\\\\"Action\\\\\\":\\\\\\"sns:Publish\\\\\\",\\\\\\"Resource\\\\\\":\\\\\\"\${aws_sns_topic.my_bucket_my_bucket-onupdate_ADC4AA5B.arn}\\\\\\",\\\\\\"Condition\\\\\\":{\\\\\\"ArnEquals\\\\\\":{\\\\\\"aws:SourceArn\\\\\\":\\\\\\"\${aws_s3_bucket.my_bucket.arn}\\\\\\"}}}]}\\"
      }
    },
    \\"aws_sns_topic_subscription\\": {
      \\"my_bucket_my_bucket-onupdate_my_bucket-onupdate-TopicSubscription-02f87005_6CFFDD03\\": {
        \\"endpoint\\": \\"\${aws_lambda_function.my_bucket_my_bucket-onupdate-OnMessage-02f87005_5A1876F6.arn}\\",
        \\"protocol\\": \\"lambda\\",
        \\"topic_arn\\": \\"\${aws_sns_topic.my_bucket_my_bucket-onupdate_ADC4AA5B.arn}\\"
      }
    }
  }
}"
`;

exports[`bucket with onUpdate method 2`] = `
{
  "tree": {
    "children": {
      "root": {
        "children": {
          "Default": {
            "children": {
              "Code": {
                "constructInfo": {
                  "fqn": "cdktf.TerraformResource",
                  "version": "0.17.0",
                },
                "id": "Code",
                "path": "root/Default/Code",
              },
              "aws": {
                "constructInfo": {
                  "fqn": "cdktf.TerraformProvider",
                  "version": "0.17.0",
                },
                "id": "aws",
                "path": "root/Default/aws",
              },
              "cloud.TestRunner": {
                "attributes": {
                  "wing:resource:connections": [],
                },
                "children": {
                  "TestFunctionArns": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformOutput",
                      "version": "0.17.0",
                    },
                    "id": "TestFunctionArns",
                    "path": "root/Default/cloud.TestRunner/TestFunctionArns",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A suite of APIs for running tests and collecting results.",
                  "hidden": true,
                  "title": "TestRunner",
                  "type": "user-named",
                },
                "id": "cloud.TestRunner",
                "path": "root/Default/cloud.TestRunner",
              },
              "inflight": {
                "attributes": {
                  "wing:resource:connections": [
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "handle()",
                      "resource": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005",
                    },
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "$inflight_init()",
                      "resource": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005",
                    },
                  ],
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "An inflight resource",
                  "hidden": true,
                  "title": "Inflight",
                  "type": "user-named",
                },
                "id": "inflight",
                "path": "root/Default/inflight",
              },
              "my_bucket": {
                "attributes": {
                  "wing:resource:connections": [
                    {
                      "direction": "outbound",
                      "implicit": false,
                      "relationship": "onUpdate()",
                      "resource": "root/Default/my_bucket/my_bucket-onupdate",
                    },
                  ],
                },
                "children": {
                  "Default": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Default",
                    "path": "root/Default/my_bucket/Default",
                  },
                  "Encryption": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Encryption",
                    "path": "root/Default/my_bucket/Encryption",
                  },
                  "PublicAccessBlock": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "PublicAccessBlock",
                    "path": "root/Default/my_bucket/PublicAccessBlock",
                  },
                  "PublicPolicy": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "PublicPolicy",
                    "path": "root/Default/my_bucket/PublicPolicy",
                  },
                  "S3BucketNotification": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "S3BucketNotification",
                    "path": "root/Default/my_bucket/S3BucketNotification",
                  },
                  "my_bucket-onupdate": {
                    "attributes": {
                      "wing:resource:connections": [
                        {
                          "direction": "inbound",
                          "implicit": false,
                          "relationship": "onUpdate()",
                          "resource": "root/Default/my_bucket",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "onMessage()",
                          "resource": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005",
                        },
                      ],
                    },
                    "children": {
                      "Default": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "Default",
                        "path": "root/Default/my_bucket/my_bucket-onupdate/Default",
                      },
                      "PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a",
                        "path": "root/Default/my_bucket/my_bucket-onupdate/PublishPermission-c8045fccc85a7ef42d5391d87958e5ce36c53a401a",
                      },
                      "my_bucket-onupdate-TopicSubscription-02f87005": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "my_bucket-onupdate-TopicSubscription-02f87005",
                        "path": "root/Default/my_bucket/my_bucket-onupdate/my_bucket-onupdate-TopicSubscription-02f87005",
                      },
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "description": "A pub/sub notification topic",
                      "title": "Topic",
                      "type": "user-named",
                    },
                    "id": "my_bucket-onupdate",
                    "path": "root/Default/my_bucket/my_bucket-onupdate",
                  },
                  "my_bucket-onupdate-OnMessage-02f87005": {
                    "attributes": {
                      "wing:resource:connections": [
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "handle()",
                          "resource": "root/Default/inflight",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "$inflight_init()",
                          "resource": "root/Default/inflight",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "handle()",
                          "resource": "root/Default/my_bucket-onupdate-eventHandler-9eade8f6",
                        },
                        {
                          "direction": "outbound",
                          "implicit": false,
                          "relationship": "$inflight_init()",
                          "resource": "root/Default/my_bucket-onupdate-eventHandler-9eade8f6",
                        },
                        {
                          "direction": "inbound",
                          "implicit": false,
                          "relationship": "onMessage()",
                          "resource": "root/Default/my_bucket/my_bucket-onupdate",
                        },
                      ],
                    },
                    "children": {
                      "Asset": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformAsset",
                          "version": "0.17.0",
                        },
                        "id": "Asset",
                        "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005/Asset",
                      },
                      "Default": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "Default",
                        "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005/Default",
                      },
                      "IamRole": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRole",
                        "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005/IamRole",
                      },
                      "IamRolePolicy": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRolePolicy",
                        "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005/IamRolePolicy",
                      },
                      "IamRolePolicyAttachment": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "IamRolePolicyAttachment",
                        "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005/IamRolePolicyAttachment",
                      },
                      "InvokePermission-c85a09033744f6af2426f88e40823fbfd778fbdc16": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "InvokePermission-c85a09033744f6af2426f88e40823fbfd778fbdc16",
                        "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005/InvokePermission-c85a09033744f6af2426f88e40823fbfd778fbdc16",
                      },
                      "S3Object": {
                        "constructInfo": {
                          "fqn": "cdktf.TerraformResource",
                          "version": "0.17.0",
                        },
                        "id": "S3Object",
                        "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005/S3Object",
                      },
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "description": "A cloud function (FaaS)",
                      "title": "Function",
                      "type": "compiler-named",
                    },
                    "id": "my_bucket-onupdate-OnMessage-02f87005",
                    "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005",
                  },
                  "my_bucket-onupdate-OnMessageHandler-02f87005": {
                    "attributes": {
                      "wing:resource:connections": [],
                    },
                    "constructInfo": {
                      "fqn": "constructs.Construct",
                      "version": "10.1.314",
                    },
                    "display": {
                      "hidden": true,
                      "type": "user-named",
                    },
                    "id": "my_bucket-onupdate-OnMessageHandler-02f87005",
                    "path": "root/Default/my_bucket/my_bucket-onupdate-OnMessageHandler-02f87005",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A cloud object store",
                  "title": "Bucket",
                  "type": "user-named",
                },
                "id": "my_bucket",
                "path": "root/Default/my_bucket",
              },
              "my_bucket-onupdate-eventHandler-9eade8f6": {
                "attributes": {
                  "wing:resource:connections": [
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "handle()",
                      "resource": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005",
                    },
                    {
                      "direction": "inbound",
                      "implicit": false,
                      "relationship": "$inflight_init()",
                      "resource": "root/Default/my_bucket/my_bucket-onupdate-OnMessage-02f87005",
                    },
                  ],
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "hidden": true,
                  "type": "user-named",
                },
                "id": "my_bucket-onupdate-eventHandler-9eade8f6",
                "path": "root/Default/my_bucket-onupdate-eventHandler-9eade8f6",
              },
            },
            "constructInfo": {
              "fqn": "constructs.Construct",
              "version": "10.1.314",
            },
            "id": "Default",
            "path": "root/Default",
          },
          "backend": {
            "constructInfo": {
              "fqn": "cdktf.LocalBackend",
              "version": "0.17.0",
            },
            "id": "backend",
            "path": "root/backend",
          },
        },
        "constructInfo": {
          "fqn": "cdktf.TerraformStack",
          "version": "0.17.0",
        },
        "id": "root",
        "path": "root",
      },
    },
    "constructInfo": {
      "fqn": "cdktf.App",
      "version": "0.17.0",
    },
    "id": "App",
    "path": "",
  },
  "version": "tree-0.1",
}
`;

exports[`bucket with two preflight objects 1`] = `
"{
  \\"output\\": {
    \\"WING_TEST_RUNNER_FUNCTION_ARNS\\": {
      \\"value\\": \\"[]\\"
    }
  },
  \\"resource\\": {
    \\"aws_s3_bucket\\": {
      \\"my_bucket\\": {
        \\"bucket_prefix\\": \\"my-bucket-c8045fcc-\\",
        \\"force_destroy\\": false
      }
    },
    \\"aws_s3_bucket_policy\\": {
      \\"my_bucket_PublicPolicy_AF351571\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"depends_on\\": [
          \\"aws_s3_bucket_public_access_block.my_bucket_PublicAccessBlock_538547C0\\"
        ],
        \\"policy\\": \\"{\\\\\\"Version\\\\\\":\\\\\\"2012-10-17\\\\\\",\\\\\\"Statement\\\\\\":[{\\\\\\"Effect\\\\\\":\\\\\\"Allow\\\\\\",\\\\\\"Principal\\\\\\":\\\\\\"*\\\\\\",\\\\\\"Action\\\\\\":[\\\\\\"s3:GetObject\\\\\\"],\\\\\\"Resource\\\\\\":[\\\\\\"\${aws_s3_bucket.my_bucket.arn}/*\\\\\\"]}]}\\"
      }
    },
    \\"aws_s3_bucket_public_access_block\\": {
      \\"my_bucket_PublicAccessBlock_538547C0\\": {
        \\"block_public_acls\\": false,
        \\"block_public_policy\\": false,
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"ignore_public_acls\\": false,
        \\"restrict_public_buckets\\": false
      }
    },
    \\"aws_s3_bucket_server_side_encryption_configuration\\": {
      \\"my_bucket_Encryption_3B1569A4\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"rule\\": [
          {
            \\"apply_server_side_encryption_by_default\\": {
              \\"sse_algorithm\\": \\"AES256\\"
            }
          }
        ]
      }
    },
    \\"aws_s3_object\\": {
      \\"my_bucket_S3Object-file1txt_7AFE54AE\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"content\\": \\"hello world\\",
        \\"key\\": \\"file1.txt\\"
      },
      \\"my_bucket_S3Object-file2txt_CB6BC703\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"content\\": \\"boom bam\\",
        \\"key\\": \\"file2.txt\\"
      }
    }
  }
}"
`;

exports[`bucket with two preflight objects 2`] = `
{
  "tree": {
    "children": {
      "root": {
        "children": {
          "Default": {
            "children": {
              "aws": {
                "constructInfo": {
                  "fqn": "cdktf.TerraformProvider",
                  "version": "0.17.0",
                },
                "id": "aws",
                "path": "root/Default/aws",
              },
              "cloud.TestRunner": {
                "attributes": {
                  "wing:resource:connections": [],
                },
                "children": {
                  "TestFunctionArns": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformOutput",
                      "version": "0.17.0",
                    },
                    "id": "TestFunctionArns",
                    "path": "root/Default/cloud.TestRunner/TestFunctionArns",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A suite of APIs for running tests and collecting results.",
                  "hidden": true,
                  "title": "TestRunner",
                  "type": "user-named",
                },
                "id": "cloud.TestRunner",
                "path": "root/Default/cloud.TestRunner",
              },
              "my_bucket": {
                "attributes": {
                  "wing:resource:connections": [],
                },
                "children": {
                  "Default": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Default",
                    "path": "root/Default/my_bucket/Default",
                  },
                  "Encryption": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Encryption",
                    "path": "root/Default/my_bucket/Encryption",
                  },
                  "PublicAccessBlock": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "PublicAccessBlock",
                    "path": "root/Default/my_bucket/PublicAccessBlock",
                  },
                  "PublicPolicy": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "PublicPolicy",
                    "path": "root/Default/my_bucket/PublicPolicy",
                  },
                  "S3Object-file1.txt": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "S3Object-file1.txt",
                    "path": "root/Default/my_bucket/S3Object-file1.txt",
                  },
                  "S3Object-file2.txt": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "S3Object-file2.txt",
                    "path": "root/Default/my_bucket/S3Object-file2.txt",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A cloud object store",
                  "title": "Bucket",
                  "type": "user-named",
                },
                "id": "my_bucket",
                "path": "root/Default/my_bucket",
              },
            },
            "constructInfo": {
              "fqn": "constructs.Construct",
              "version": "10.1.314",
            },
            "id": "Default",
            "path": "root/Default",
          },
          "backend": {
            "constructInfo": {
              "fqn": "cdktf.LocalBackend",
              "version": "0.17.0",
            },
            "id": "backend",
            "path": "root/backend",
          },
        },
        "constructInfo": {
          "fqn": "cdktf.TerraformStack",
          "version": "0.17.0",
        },
        "id": "root",
        "path": "root",
      },
    },
    "constructInfo": {
      "fqn": "cdktf.App",
      "version": "0.17.0",
    },
    "id": "App",
    "path": "",
  },
  "version": "tree-0.1",
}
`;

exports[`create a bucket 1`] = `
"{
  \\"output\\": {
    \\"WING_TEST_RUNNER_FUNCTION_ARNS\\": {
      \\"value\\": \\"[]\\"
    }
  },
  \\"resource\\": {
    \\"aws_s3_bucket\\": {
      \\"my_bucket\\": {
        \\"bucket_prefix\\": \\"my-bucket-c8045fcc-\\",
        \\"force_destroy\\": false
      }
    },
    \\"aws_s3_bucket_public_access_block\\": {
      \\"my_bucket_PublicAccessBlock_538547C0\\": {
        \\"block_public_acls\\": true,
        \\"block_public_policy\\": true,
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"ignore_public_acls\\": true,
        \\"restrict_public_buckets\\": true
      }
    },
    \\"aws_s3_bucket_server_side_encryption_configuration\\": {
      \\"my_bucket_Encryption_3B1569A4\\": {
        \\"bucket\\": \\"\${aws_s3_bucket.my_bucket.bucket}\\",
        \\"rule\\": [
          {
            \\"apply_server_side_encryption_by_default\\": {
              \\"sse_algorithm\\": \\"AES256\\"
            }
          }
        ]
      }
    }
  }
}"
`;

exports[`create a bucket 2`] = `
{
  "tree": {
    "children": {
      "root": {
        "children": {
          "Default": {
            "children": {
              "aws": {
                "constructInfo": {
                  "fqn": "cdktf.TerraformProvider",
                  "version": "0.17.0",
                },
                "id": "aws",
                "path": "root/Default/aws",
              },
              "cloud.TestRunner": {
                "attributes": {
                  "wing:resource:connections": [],
                },
                "children": {
                  "TestFunctionArns": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformOutput",
                      "version": "0.17.0",
                    },
                    "id": "TestFunctionArns",
                    "path": "root/Default/cloud.TestRunner/TestFunctionArns",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A suite of APIs for running tests and collecting results.",
                  "hidden": true,
                  "title": "TestRunner",
                  "type": "user-named",
                },
                "id": "cloud.TestRunner",
                "path": "root/Default/cloud.TestRunner",
              },
              "my_bucket": {
                "attributes": {
                  "wing:resource:connections": [],
                },
                "children": {
                  "Default": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Default",
                    "path": "root/Default/my_bucket/Default",
                  },
                  "Encryption": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "Encryption",
                    "path": "root/Default/my_bucket/Encryption",
                  },
                  "PublicAccessBlock": {
                    "constructInfo": {
                      "fqn": "cdktf.TerraformResource",
                      "version": "0.17.0",
                    },
                    "id": "PublicAccessBlock",
                    "path": "root/Default/my_bucket/PublicAccessBlock",
                  },
                },
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.1.314",
                },
                "display": {
                  "description": "A cloud object store",
                  "title": "Bucket",
                  "type": "user-named",
                },
                "id": "my_bucket",
                "path": "root/Default/my_bucket",
              },
            },
            "constructInfo": {
              "fqn": "constructs.Construct",
              "version": "10.1.314",
            },
            "id": "Default",
            "path": "root/Default",
          },
          "backend": {
            "constructInfo": {
              "fqn": "cdktf.LocalBackend",
              "version": "0.17.0",
            },
            "id": "backend",
            "path": "root/backend",
          },
        },
        "constructInfo": {
          "fqn": "cdktf.TerraformStack",
          "version": "0.17.0",
        },
        "id": "root",
        "path": "root",
      },
    },
    "constructInfo": {
      "fqn": "cdktf.App",
      "version": "0.17.0",
    },
    "id": "App",
    "path": "",
  },
  "version": "tree-0.1",
}
`;
