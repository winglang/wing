<html>
  <link
    rel="stylesheet"
    href="https://unpkg.com/@highlightjs/cdn-assets@11.6.0/styles/default.min.css"
  />
  <script type="module">
    import hljs from "https://unpkg.com/@highlightjs/cdn-assets@11.6.0/es/highlight.min.js";
    import javascript from "https://unpkg.com/@highlightjs/cdn-assets@11.6.0/es/languages/javascript.min.js";
    hljs.registerLanguage("javascript", javascript);

    import MyWorker from "./worker?worker";

    const worker = new MyWorker();

    const sendCodeToWorker = (text) => {
      worker.postMessage(code.value);
    };

    window.onload = async function () {
      const code = document.getElementById("code");
      const intermediateJS = document.getElementById("intermediateJS");
      const stdout = document.getElementById("stdout");

      code.addEventListener("input", () => sendCodeToWorker(code.value));

      worker.addEventListener("message", (e) => {
        if (e.data === "WORKER_READY") {
          // worker is ready (takes a while), send whatever initial data is currently in the textarea
          sendCodeToWorker(code.value);
        } else {
          stdout.textContent = e.data.stdout;
          intermediateJS.textContent = e.data.intermediateJS;
          hljs.highlightAll();
        }
      });
    };
  </script>
  <body>
    <h1>Wing Playground</h1>
    <main>
      <section id="wing-side">
        <textarea id="code">
bring cloud;

let bucket = new cloud.Bucket();

inflight handler() {
  bucket.upload("file.txt", "data");
  bucket.delete("file.txt");
}

new cloud.Function(handler);</textarea
        >
      </section>
      <section id="js-side">
        <pre>
          <code class="language-javascript" id="intermediateJS"></code>
        </pre>
        <pre>
          <code id="stdout"></code>
        </pre>
      </section>
    </main>
  </body>
  <style>
    body {
      font-family: monospace;
      font-size: 16px;
    }

    h1 {
      text-align: center;
    }

    main {
      display: flex;
      height: 100vh;
    }

    textarea {
      white-space: pre-wrap;
      width: 100%;
      height: 100%;
    }

    #wing-side {
      flex-grow: 1;
      padding: 2rem;
      height: 80vh;
    }

    #js-side {
      width: 60%;
      height: 80vh;
      font-size: 12;
    }

    #intermediateJS {
      height: 98%;
    }
  </style>
</html>
